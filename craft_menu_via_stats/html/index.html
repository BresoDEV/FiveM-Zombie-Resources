<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css" type="text/css">
    <link rel="stylesheet" href="reset.css" type="text/css">
    <script src="nui://game/ui/jquery.js" type="text/javascript"></script>

    <title>PenisMan</title>
</head>
<style>
    .kkkkkk {
        width: 100%;
        height: 100%;
        position: fixed;
        backdrop-filter: blur(0px);
    }
</style>

<body>

    

    <div class="menu" id="container">

        
        <form id="form">




            <div class="fundo-centro" id="centro">

                <!--aqui vai os bloquinhos-->


            </div>

            <div class="menu-direita" id="direita">


            </div>




            <div class="resultado" id="resultado">
                <center>
                    <div class="bloquinho" id="resultado_bloquinho" style="width: 50%;">
                        <img src="ferro.png" alt="" title="" id="resultado_foto">
                        <p id="resultado_nome_item">Fogueira</p>
                    </div>
                    <div class="button" id="craftar">Criar</div>
                </center>
            </div>

            <center>
                <div class="limpar-mesa" id="limpar-mesa">Reiniciar</div>
                <div class="sair" id="sair">Sair</div>
            </center>



        </form>
    </div>
    <script src="./script.js" type="text/javascript"></script>

</body>
<script>


   


var inventario = [
    {
        nome_bruto: 'Madeira',
        foto: 'madeira.png',
        quantidade: 1,
        quantidade_bau: 0,
        stat_usado: 'MPPLY_CREW_HEIST_CASH_0',
        quantidade_na_mesa: 0
    },
    {
        nome_bruto: 'Ferro',
        foto: 'ferro.png',
        quantidade: 0,
        quantidade_bau: 0,
        stat_usado: 'MPPLY_CREW_HEIST_CASH_1',
        quantidade_na_mesa: 0
    },
    {
        nome_bruto: 'Cabana',
        foto: 'cabana.png',
        quantidade: 0,
        quantidade_bau: 0,
        stat_usado: 'MPPLY_CREW_HEIST_CASH_2',
        quantidade_na_mesa: 0
    },
]



var receitas = [
    {
        nome: 'Cabana',
        foto: 'cabana.png'
    }
]





function display(bool) {
    if (bool) {
        document.getElementById('container').style.display = 'block'
        //$("#container").show();
    } else {
       // $("#container").hide();
       document.getElementById('container').style.display = 'none'
    }
}

display(false)




window.addEventListener('message', function (event) {
    var item = event.data;
    if (item.type === "ui") {
        if (item.status == true) {
            

           
            inventario[0].quantidade = parseInt(item.madeira)
            inventario[1].quantidade = parseInt(item.ferro)
            inventario[2].quantidade = parseInt(item.cabana)

            console.log("salvo no array madeira: " + inventario[0].quantidade)
            console.log("salvo no array ferro: " + inventario[1].quantidade)
            console.log("salvo no array cabana: " + inventario[2].quantidade)

            display(true)
            recarregarInventario()

        } else {
            display(false)
        }
    }
})














    var itemSelecionadoAtualmente;
    var blur = 0;


     


    setInterval(() => {
        var definir_resultado = ''

        definir_resultado = 'Cabana'
        if (tem_na_mesa('Madeira', 1)) {
            if (tem_na_mesa('Ferro', 1)) {

                receitas.forEach(craft => {
                    if (craft.nome === definir_resultado) {
                        document.getElementById('resultado_foto').src = craft.foto
                        document.getElementById('resultado_nome_item').innerHTML = craft.nome
                        document.getElementById('resultado').style.display = 'block'
                    }
                });
            }
        }
        else {
            document.getElementById('resultado').style.display = 'none'
        }






    }, 1);





    document.getElementById('limpar-mesa').addEventListener('click', () => {
        //var item = document.getElementById('resultado_nome_item').innerHTML
        inventario.forEach(e => {
            if (e.quantidade_na_mesa >= 1) {
                e.quantidade = e.quantidade + e.quantidade_na_mesa
                e.quantidade_na_mesa = 0
                while(e.quantidade_na_mesa !== 0){
                    e.quantidade_na_mesa = 0
                }
            }
        });



        document.getElementById('direita').innerHTML = ''
        document.getElementById('resultado').style.display = 'none'
        document.getElementById('limpar-mesa').style.display = 'none'

        recarregarInventario()
        
    })


    document.getElementById('craftar').addEventListener('click', () => {
        var item = document.getElementById('resultado_nome_item').innerHTML
        inventario.forEach(e => {
            if (e.nome_bruto === item) {
                e.quantidade = e.quantidade + 1
            }
        });

        inventario.forEach(e => {
            e.quantidade_na_mesa = 0
        });

        alertaOK('Sucesso', '<i>1x ' + item + ' adicionado</i>')


         

        $.post("http://craft_menu_via_stats/attStats", JSON.stringify({
            madeira: inventario[0].quantidade,
            ferro:inventario[1].quantidade,
            cabana:inventario[2].quantidade,
                }));
          


        document.getElementById('direita').innerHTML = ''
        document.getElementById('resultado').style.display = 'none'
        document.getElementById('limpar-mesa').style.display = 'none'

        console.log(inventario)


        recarregarInventario()
    })






    function tem_na_mesa(nome, quant) {
        var bool = false
        inventario.forEach(mesa => {
            if (mesa.nome_bruto === nome) {
                if (mesa.quantidade_na_mesa === quant) {
                    bool = true
                }
            }

        });
        return bool
    }










    recarregarInventario()

    function recarregarInventario() {
        document.getElementById('centro').innerHTML = ''
        var itens_na_tela = 0
        inventario.forEach(i => {

            if (i.quantidade > 0) {

                document.getElementById('centro').innerHTML += `
                <div class="bloquinho"  id="centro_${i.nome_bruto}">
                    <img src="${i.foto}" alt="" title="" id="foto_${i.nome_bruto}">
                    <p>${i.quantidade}</p>
                </div>
            `
                itens_na_tela++
            }
        });
        for (let index = itens_na_tela; index < 20; index++) {
            document.getElementById('centro').innerHTML += `
            <div class="bloquinho"  id=""></div>
            `
        }
        redimencionaBloquinhos()
        moverParaMesa()
        todosBloquinhosPreto()

        //redimenciona os containers
        document.getElementById('centro').style.height = (window.innerHeight / 1.5) + 'px'
        document.getElementById('direita').style.height = (window.innerHeight / 2.5) + 'px'
        document.getElementById('resultado').style.top = (window.innerHeight / 1.9) + 'px'


    }





    function moverParaMesa() {
        var lista = document.getElementById('centro').querySelectorAll('*')
        lista.forEach(e => {
            if (e.id.includes('centro_')) {
                var id_sem_id = e.id.replace('centro_', '')

                e.addEventListener('click', () => {

                    if (e !== itemSelecionadoAtualmente) {
                        todosBloquinhosPreto()
                        itemSelecionadoAtualmente = e
                    }

                    //if(e.style.backgroundColor  === 'rgba(53, 115, 248, 0.77)'){
                    if (e.style.backgroundColor === 'rgba(17, 17, 17, 0.77)') {
                        e.style.backgroundColor = 'rgba(53, 115, 248, 0.77)'
                    }
                    else {
                        inventario.forEach(inv => {

                            if (inv.nome_bruto === id_sem_id) {
                                inv.quantidade = inv.quantidade - 1
                                inv.quantidade_na_mesa = inv.quantidade_na_mesa + 1


                                document.getElementById('direita').innerHTML += `
                                    <div class="bloquinho"  id="direita_${inv.nome_bruto}">
                                        <img src="${inv.foto}" alt="" title="" id="foto_${inv.nome_bruto}">
                                        <p>${inv.nome_bruto}</p>
                                    </div>`

                                document.getElementById('limpar-mesa').style.display = 'block'
                            }
                        });

                        recarregarInventario()
                    }




                })


            }
        });
    }







    function redimencionaBloquinhos() {
        const bloquinhos = document.querySelectorAll('div')
        bloquinhos.forEach(b => {
            if (b.classList.contains('bloquinho')) {
                b.style.height = b.offsetWidth + 'px'
                b.style.minHeight = b.offsetWidth + 'px'
                b.style.maxHeight = b.offsetWidth + 'px'
            }
        });
    }

    function todosBloquinhosPreto() {
        const bloquinhos = document.querySelectorAll('div')
        bloquinhos.forEach(b => {
            if (b.classList.contains('bloquinho')) {
                b.style.backgroundColor = 'rgba(17, 17, 17, 0.767)'
            }
        });
    }




    function alertaOK(tit, txt) {

        var i_left = -260
        var opacidade = 1.0

        const f = document.createElement('div')
        f.style.backgroundColor = 'green'
        f.style.position = 'fixed'
        f.style.left = i_left + 'px'
        f.style.top = '25%'
        f.style.width = '250px'
        f.style.height = '50px'
        f.style.borderRadius = '50px'
        f.style.display = 'flex'
        f.style.opacity = opacidade


        const bola = document.createElement('div')
        bola.style.width = '25%'
        bola.style.backgroundColor = 'lime'
        bola.style.height = '50px'
        bola.style.borderRadius = '50px'
        bola.style.opacity = '0.7'

        const titulo = document.createElement('p')
        titulo.style.width = '100%'
        titulo.style.marginLeft = '0%'
        titulo.style.marginTop = '2%'
        titulo.style.color = 'white'
        titulo.innerHTML = '<center><b>' + tit + '</b><br><i>' + txt + '</i></center>'




        f.appendChild(bola)
        f.appendChild(titulo)
        document.body.appendChild(f)

        var i_top = f.offsetTop

        var p1 = true
        var p2 = false

        var loop = setInterval(() => {


            if (p1) {
                f.style.left = i_left + 'px'
                i_left++
                i_left++
                if (i_left === 10) {
                    p1 = false

                    setTimeout(() => {
                        p2 = true
                    }, 2000);
                }
            }
            if (p2) {

                f.style.opacity = opacidade
                opacidade = opacidade - 0.004

                f.style.top = i_top + 'px'
                i_top++
                if (i_top === 10000) {
                    clearInterval(loop)
                }
            }
        }, 1);
    }

    function alertaERRO(tit, txt) {

        var i_left = -260
        var opacidade = 1.0

        const f = document.createElement('div')
        f.style.backgroundColor = 'red'
        f.style.position = 'fixed'
        f.style.left = i_left + 'px'
        f.style.top = '25%'
        f.style.width = '250px'
        f.style.height = '50px'
        f.style.borderRadius = '50px'
        f.style.display = 'flex'
        f.style.opacity = opacidade


        const bola = document.createElement('div')
        bola.style.width = '25%'
        bola.style.backgroundColor = 'rgb(200,100,100)'
        bola.style.height = '50px'
        bola.style.borderRadius = '50px'
        bola.style.opacity = '0.7'

        const titulo = document.createElement('p')
        titulo.style.width = '100%'
        titulo.style.marginLeft = '0%'
        titulo.style.marginTop = '2%'
        titulo.style.color = 'white'
        titulo.innerHTML = '<center><b>' + tit + '</b><br><i>' + txt + '</i></center>'




        f.appendChild(bola)
        f.appendChild(titulo)
        document.body.appendChild(f)

        var i_top = f.offsetTop

        var p1 = true
        var p2 = false

        var loop = setInterval(() => {


            if (p1) {
                f.style.left = i_left + 'px'
                i_left++
                i_left++
                if (i_left === 10) {
                    p1 = false

                    setTimeout(() => {
                        p2 = true
                    }, 2000);
                }
            }
            if (p2) {

                f.style.opacity = opacidade
                opacidade = opacidade - 0.004

                f.style.top = i_top + 'px'
                i_top++
                if (i_top === 10000) {
                    clearInterval(loop)
                }
            }
        }, 1);
    }


    document.getElementById('sair').addEventListener('click', () => {
        $.post("http://craft_menu_via_stats/exit", JSON.stringify({
                    vazio: 'vazio'
                }));
    })

</script>

</html>